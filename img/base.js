ec.pkg("ec.account");ec.load("jquery.autocomplete",{loadType:"lazy",callback:function(){$("#search-kw").autocomplete({serviceUrl:"/search_keywords",minChars:1,maxHeight:400,deferRequestBy:100})}});ec.load("ec.box");ec.account.customerInfo=function(){this.zmPoint=null;this.empiricalValue=null};var g_pointBlance=0;var g_couponCount=0;var g_balanceAmount=0;var g_newMsgCount=0;var g_totalPoint=0;function gid(b){return document.getElementById(b)}ec.account.isLogin=function(){return ec.account.id&&ec.account.loginName};ec.account.getStatus=function(b){$.ajax({url:domainAccount+"/status.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,jsonop:"callback",type:"get",success:function(d){if(d&&d.id>0){ec.account.id=d.id;ec.account.uid=d.uid;ec.account.name=d.name;ec.account.nickName=d.nickName;ec.account.displayName=d.displayName;ec.account.loginName=d.loginName;ec.account.email=d.email;ec.account.mobile=d.mobile;ec.account.isQueue=d.isQueue;ec.account.custGrade=d.custGrade;ec.account.custPrivilege=d.custPrivilege;ec.account.custPoint=d.custPoint;ec.account.userState=d.userState;ec.account.isAuthCust=d.isAuthCust;var c=ec.util.cookie.get("ifl_v");if(c=="1"){$.ajax({url:"/account/load",type:"POST"})}}b()}})};ec.account.getAccountStatus=function(b,d,c){if(b){if(c){ec.load({url:domainMain+"/account/status?"+(new Date()).getTime(),type:"js",onload:d})}else{ec.load({url:domainMain+"/account/status?"+(new Date()).getTime(),type:"js",loadType:"lazy",onload:d})}}};ec.account.getLoginInfo=function(h,f){var b=ec.util.cookie.get("ac_li");var d=ec.util.cookie.get("uid");var c=ec.util.cookie.get("isValCas");try{if(d&&c&&"false"==c){ec.account.id=ec.util.cookie.get("uid");ec.account.uid=ec.util.cookie.get("uid");ec.account.name=ec.util.cookie.get("user");ec.account.nickName=ec.util.cookie.get("name");ec.account.displayName=ec.util.cookie.get("displayName");ec.account.loginName=ec.util.cookie.get("user");ec.account.isValCas="false";$.ajax({url:"/account/load?uid="+d,async:false,type:"POST"});ec.account.getAccountStatus(d,h,f);ec.account.isValCas=ec.util.cookie.get("isValCas");h();return}if(b&&d){ec.account.id=ec.util.cookie.get("uid");ec.account.uid=ec.util.cookie.get("uid");ec.account.name=ec.util.cookie.get("user");ec.account.nickName=ec.util.cookie.get("name");ec.account.displayName=ec.util.cookie.get("displayName");ec.account.loginName=ec.util.cookie.get("ac_loNa");ec.account.email=ec.util.cookie.get("ac_lel");ec.account.mobile=ec.util.cookie.get("ac_lmi");ec.account.isQueue=ec.util.cookie.get("ac_liq");ec.account.custGrade=ec.util.cookie.get("ac_lgc");ec.account.custPrivilege=ec.util.cookie.get("ac_cp");ec.account.custPoint=ec.util.cookie.get("ac_ltp");ec.account.userState=ec.util.cookie.get("ac_lus");h();return}}catch(g){}ec.account.getAccountStatus(d,h,f)};ec.account.confirmSaleConfig=function(){var b=$("#checkSaleConfig").attr("checked")?"1":"0";new ec.ajax().get({url:"/saleinfo/setSaleInfoRcvCfg.json?send_sms="+b+"&send_email="+b+"&t="+new Date().getTime(),async:true,timeout:10000,successFunction:function(c){console.log("json:"+c);if(!c.success){return}ec.util.cookie.set("isFirstLogin","0",{domain:".vmall.com",path:"/"})},timeoutFunction:function(){return},errorFunction:function(){return}})};ec.account.displaySaleConfig=function(){var d=ec.util.cookie.get("isFirstLogin");if(d&&d=="1"){var b=[];b.push('      <div class="box-prompt-success-area">');b.push('         <div class="h pdt-40 pdb-40">');b.push('             <img src="'+imagePath+'/echannel/sprites/sprites33.png" alt="">');b.push("         </div>");b.push('        <div class="b pdb-16">');b.push('            <label class="vat"><input id="checkSaleConfig" class="vam" type="checkbox" checked />&nbsp;&nbsp;<p class="f12 gray inline-block vam">\u540c\u610f\u63a5\u6536\u8425\u9500\u4fe1\u606f</p></label>&nbsp;&nbsp;<a href="/help/faq-2635.html" target="_blank" class="vam f12 blue">\u66f4\u591a\u76f8\u5173\u4fe1\u606f</a>');b.push("        </div>");b.push("     </div>");b.push('    <div class="box-custom-button">');b.push('       <a onclick="ec.account.confirmSaleConfig()"  class="box-ok box-button-style-2"><span>\u5f00\u59cb\u8d2d\u7269</span></a>');b.push("    </div>");var c=new ec.box(b.join(" "),{boxid:"ec_sale_config",boxclass:"ol_box_4",title:'<font color="#CA151E">\u6b22\u8fce\u6765\u5230\u534e\u4e3a\u5546\u57ce</font>',remember:false,width:540,showButton:false});c.open()}};ec.account.getZMInfo=function(){$.ajax({url:$("#domainUc").val()+"/zm/queryZM.json",dataType:"jsonp",timeout:10000,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},success:function(b){if(b.resultCode=="200"&&b.userZMInfoVO){if(b.userZMInfoVO.certifyStatus==1){$("#zhimaPoint").html(b.userZMInfoVO.creditScore);ec.account.customerInfo.zmPoint=b.userZMInfoVO.creditScore}}}})};ec.account.getAccountInfo=function(b){$.ajax({url:domainMain+"/member/accountInfo.json",dataType:"jsonp",timeout:10000,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},success:function(c){if(!c.success){return}b(c)}})};ec.account.showCustoemrInfo=function(json){if(json.couponCount){g_couponCount=json.couponCount;$("#top-couponCount").html(json.couponCount)}if(json.newMsgCount){g_newMsgCount=json.newMsgCount;$("#top-newMsgCount").html(json.newMsgCount).attr("class",(json.newMsgCount<=0)?"hide":"")}if(json.customerInfo){var customerInfo=json.customerInfo;if(customerInfo.headPictureURL){$("#customerPic").attr("src",customerInfo.headPictureURL);$("#gg_customerPic").attr("src",customerInfo.headPictureURL)}if(customerInfo.totalPoint){$("#empiricalValue").html(customerInfo.totalPoint);ec.account.customerInfo.empiricalValue=customerInfo.totalPoint;g_totalPoint=customerInfo.totalPoint}if(customerInfo.mobileStatus&&(customerInfo.mobileStatus=="1")){$("#validateMobile").html("\u5df2\u9a8c\u8bc1\u624b\u673a").removeClass("link-non-validated").addClass("link-validated")}if(customerInfo.emailStatus&&(customerInfo.emailStatus=="1")){$("#validateMail").html("\u5df2\u9a8c\u8bc1\u90ae\u7bb1").removeClass("link-non-validated").addClass("link-validated")}if(customerInfo.isAuthentication&&(customerInfo.isAuthentication=="1")){$("#certification").html("\u5df2\u5b9e\u540d\u8ba4\u8bc1").removeClass("link-non-validated").addClass("link-validated")}}if(json.gradeConfig){var max=json.gradeConfig.maxScores;var min=json.gradeConfig.minScores;var interval=max-min;var userScores=g_totalPoint;var cha=userScores-min;if(isNaN(interval)){interval=50000}if(cha>50000){cha=50000}var resultNum=(cha/interval)*100;if(isNaN(resultNum)){resultNum=0;userScores=0}if(resultNum<=0){resultNum=0}else{resultNum=Math.round(resultNum)}$("#userTotalPoint").html(userScores+" \u7ecf\u9a8c\u503c");$("#userTotalPoint").attr("style","width: "+resultNum+"%");$("#gg_jyz").attr("style","width: "+resultNum+"%")}if(json.allPrivileges&&json.userPrivileges){var userPrivilegesList=eval(json.userPrivileges);var userPsize=parseInt(userPrivilegesList.length);var allPrivilegesList=json.allPrivileges;var allPsize=parseInt(allPrivilegesList.length);var privilegeHtml='<div class="p-title"><h3>\u4eab\u53d7\u7279\u6743</h3><div><span></span><span></span></div></div><div class="p-content"><div id="sliderFloat" class="ec-slider"><dl style="width:100%;" class="ec-slider-list clearfix">';for(var i=0;i<allPsize;i++){var flag=true;for(var j=0;j<userPsize;j++){if(allPrivilegesList[i].id==userPrivilegesList[j].id){var nameDom='<p class="p-title">'+userPrivilegesList[j].name.substring(0,4)+"</p>";privilegeHtml+='<dd class="ec-slider-item"><p class="p-img"><a class="myPrivilege-class" href="'+domainMain+$("#context").val()+'/member/point" title="'+htmlEncode(userPrivilegesList[j].description)+'"><img src="'+userPrivilegesList[j].smallLightLogourl+'" alt="'+userPrivilegesList[j].name+'"></a></p>'+nameDom+"</dd>";flag=false}}if(flag){var nameDom='<p class="p-title">'+allPrivilegesList[i].name.substring(0,4)+"</p>";privilegeHtml+='<dd class="ec-slider-item"><p class="p-img"><a class="myPrivilege-class" href="'+domainMain+$("#context").val()+'/member/point" title="'+htmlEncode(allPrivilegesList[i].description)+'"><img src="'+allPrivilegesList[i].smallGrayLogourl+'" alt="'+allPrivilegesList[i].name+'"></a></p>'+nameDom+"</dd>"}}privilegeHtml+='</dl><div class="ec-slider-nav"><span class="pre-btn pre-btn-disabled"></span><span class="next-btn"></span></div></div></div>';$("#userPrivilege").html(privilegeHtml);var ul=$("#sliderFloat dl.ec-slider-list"),liItem=$("#sliderFloat dl.ec-slider-list dd.ec-slider-item"),btnContent=$("#sliderFloat .ec-slider-nav"),nextBtn=$("#sliderFloat .next-btn"),preBtn=$("#sliderFloat .pre-btn");var width=liItem.width(),i=Math.ceil(allPsize/4),index=0;if(allPsize<=4){btnContent.hide();return}ul.css({width:allPsize*width+"px"});nextBtn.bind("click",function(){if(!$(this).hasClass("next-btn-disabled")){index++;if(index<i){ul.animate({"margin-left":-(4*width)+"px"},200);preBtn.removeClass("pre-btn-disabled");if(index==(i-1)){$(this).addClass("next-btn-disabled")}}}});preBtn.bind("click",function(){if(!$(this).hasClass("pre-btn-disabled")){index--;if(index>=0){ul.animate({"margin-left":(parseInt(ul.css("margin-left"))+(4*width))+"px"},200,function(){nextBtn.removeClass("next-btn-disabled")});if(index==0){$(this).addClass("pre-btn-disabled")}}}})}};function htmlEncode(c){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(c).replace(/[&<>"'\/]/g,function(d){return b[d]})}ec.account.getBalanceAmount=function(){$.ajax({url:domainCds+"/gateway/queryBalance",dataType:"jsonp",success:function(b){if(b.resultCode==0){if(b.balanceAmount!=null){g_balanceAmount=(parseFloat(b.balanceAmount)).toFixed(2)}else{g_balanceAmount=0}$("#balanceAmount").html(g_balanceAmount)}}})};(function(){var c=function(){setTimeout(function(){if(ec.account.isLogin()){var h=ec.util.escapeHtml(ec.account.displayName)||ec.util.escapeHtml(ec.account.nickName)||ec.util.escapeHtml(ec.account.name)||ec.account.loginName;$("#customer_name").html(h);if($("#cart_unlogin_info")[0]){$("#cart_unlogin_info p").html('<a href="/member?t='+new Date().getTime()+'">'+h+"</a>")}$("#login_status,#cart_login_info").show();$("#up_user_center").show();$("#unlogin_status,#cust_login_info").hide();$("#loginName").html('<a href="/member?t='+new Date().getTime()+'">'+h+"</a>");$("#up_loginName").html(h);ec.account.showVipInfo();$("#top_login").removeClass().addClass("header-toolbar");$("#top_loginName").html(h);$("#top_unlogin").removeClass().addClass("header-toolbar hide");$("#gg_loginName").html("Hi,"+h);$("#gg_login").removeClass().addClass("i-mall-prompt clearfix");$("#gg_unlogin").removeClass().addClass("i-mall-prompt clearfix hide");var f=ec.util.cookie.get("isAuthCust");if("true"==f){$("#authentication").html("");$("#authentication").html('<i class="icon-authentication icon-authentication-success"></i>&nbsp;');$("#authentication_yes").removeClass().addClass("");$("#authentication_no").removeClass().addClass("hide")}else{$("#authentication").html("");$("#authentication").html('<i class="icon-authentication icon-authentication-not"></i>&nbsp;');$("#authentication_yes").removeClass().addClass("hide");$("#authentication_no").removeClass().addClass("");$("#authentication_no").html("");$("#authentication_no").html('<i class="link-non-validated"></i>\u672a\u5b9e\u540d\u8ba4\u8bc1</a>')}var g=ec.util.cookie.get("caibeiShowMsg"),d=ec.util.cookie.get("caibeiHeadShow"),e=ec.util.cookie.get("caibeiJifenUrl");if(g!=undefined&&g!=null&&g.length>0){$("#HeadShow").html(d);if(e!=undefined&&e!=null&&e.length>0){g=g+"<b>|</b><a href='"+e+"' title='\u6211\u7684\u5f69\u8d1d\u79ef\u5206' target='_blank'>\u6211\u7684\u5f69\u8d1d\u79ef\u5206</a>"}$("#ShowMsg").html(g);$("#caibeiMsg").show()}$("#newPointlogin_status").show();getPointBalance();if(window.location.pathname&&(window.location.pathname=="/"||window.location.pathname=="/index.html")){if(ec.account.isLogin()){var i=ec.util.cookie.get("isFirstLogin");if(i&&i=="1"){ec.account.displaySaleConfig()}}}}else{$("#gg_login").removeClass().addClass("i-mall-prompt clearfix hide");$("#gg_unlogin").removeClass().addClass("i-mall-prompt clearfix");$("#top_login").removeClass().addClass("header-toolbar hide");$("#top_unlogin").removeClass().addClass("header-toolbar")}},200)};var b=function(i){var h="callback"+new Date().getTime(),e="/account/login?type=frame&url="+encodeURIComponent(domainMain+"/account/upCallback.html?funName="+h+"&prePage="+encodeURIComponent(encodeURIComponent(window.location.href))),d="up-iframe-"+(new Date()).getTime(),f='<iframe class="boxIframe" width="100%" height="100%" frameborder="0" name="'+d+'" src="about:blank" scrolling="no"></iframe><script>setTimeout(function(){window["'+d+'"].location.href="'+e+'";} ,100);<\/script>';var g=new ec.box(f,{boxid:"ec_login",title:" ",remember:false,width:500,height:600,showButton:false,onclose:function(j){try{delete window[h]}catch(k){window[h]=null}j.find("iframe").each(function(){this.contentWindow.close();jQuery(this).remove()})}}).open();window[h]=function(){if(typeof isUseAccount!="undefined"&&isUseAccount=="true"){ec.account.getStatus(c)}else{ec.account.getLoginInfo(c,false);ec.util.cookie.get("ifl_v")}i();g.close()}};ec.account.afterLogin=function(d){if(ec.account.isLogin()){d()}else{b(d)}};if(typeof isUseAccount!="undefined"&&isUseAccount=="true"){ec.account.getStatus(c)}else{ec.account.getLoginInfo(c,true)}ec.ready(function(){ec.base.getTotal();$("#login_status").hover(function(){if(ec.account.customerInfo.zmPoint==null){ec.account.getZMInfo()}if(ec.account.customerInfo.empiricalValue==null){ec.account.getAccountInfo(ec.account.showCustoemrInfo)}},function(){});var d=$("#vmall_index").val();if(typeof(d)!="undefined"){if(d=="vmall_index"){if(ec.account.isLogin()){ec.account.getAccountInfo(ec.account.showCustoemrInfo);ec.account.getBalanceAmount()}}}})})();ec.account.showVipInfo=function(){if(ec.account.userState&&ec.account.userState=="1"){$("#vip-inActive").hide();$("#vip-Active i").removeClass().addClass("icon-vip-level-"+ec.account.custGrade);$("#vip-Active").attr("title","VMALL V"+ec.account.custGrade+"\u4f1a\u5458");$("#vip-Active").show();var b=[];b.push('<em class="vip-state" id="vip-info">&nbsp;&nbsp;&nbsp;&nbsp;');b.push('<a href="/member/point" title="VMALL V'+ec.account.custGrade+'\u4f1a\u5458" id="vip-Active" ><i class="icon-vip-level-'+ec.account.custGrade+'"></i></a>');b.push("</em>");$("#cart_unlogin_info p").append(b.join(""));$("#vip-Active-top i").removeClass().addClass("icon-vip-level-"+ec.account.custGrade);$("#vip-Active-top").attr("title","VMALL V"+ec.account.custGrade+"\u4f1a\u5458");$("#vip-Active-gg").removeClass().addClass("icon-vip-level-"+ec.account.custGrade);if(ec.account.custGrade=="0"){$("#oldPeople").hide();$("#newPeople").show()}else{$("#oldPeople").show();$("#newPeople").hide()}}else{if(ec.account.isValCas&&"false"==ec.account.isValCas){$("#vip-inActive").hide();$("#vip-Active").hide();$("#vip-Active-top").removeClass().addClass("icon-vip-level-0");$("#vip-Active-gg").removeClass().addClass("icon-vip-level-0");$("#oldPeople").hide();$("#newPeople").show()}else{$("#cart_unlogin_info p").append('&nbsp;&nbsp;<em class="vip-state"><a class="link-noAct" href="/member/account" id="vip-inActive" title="\u8bf7\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5373\u523b\u4eab\u53d7\u4f1a\u5458\u7279\u6743">\u53bb\u6fc0\u6d3b</a></em>');$("#vip-inActive").show();$("#vip-Active").hide();$("#vip-Active-top").removeClass().addClass("icon-vip-level-0");$("#vip-Active-gg").removeClass().addClass("icon-vip-level-0");$("#oldPeople").hide();$("#newPeople").show()}}};ec.pkg("ec.minicart");ec.minicart.del=function(d,e,b){var c={sbs:e.toString(),types:b.toString()};ec.cart.del(c,function(){$(d).parents("li").remove();ec.cart.getTotal()})};ec.minicart.content=function(){ec.cart.getMicroCartFromOrder(function(f){var b=f.cartInfo,e=f.shopInfo,d=$("#minicart-pro-empty"),h=$("#minicart-pro-list-block"),g=$("#minicart-pro-settleup");if(ec.minicart.microCartTpl){var c=0;if(b.miniTotalNumber>99){$("#header-cart-total").html("99+")}else{$("#header-cart-total").html(b.miniTotalNumber||0)}if(b.miniTotalNumber==0){$("#button-minicart-go2confirm").hide();$("#disbutton-minicart-go2confirm").show()}else{$("#button-minicart-go2confirm").show();$("#disbutton-minicart-go2confirm").hide()}if(b.totalNumber>0){$("#micro-cart-totalPrice").html("&yen;&nbsp;"+b.miniTotalPrice.toFixed(2));if(b.miniTotalOriginalPrice!=b.miniTotalPrice){$("#micro-cart-totalOriginPrice").html("&yen;&nbsp;"+b.miniTotalOriginalPrice.toFixed(2))}else{$("#micro-cart-totalOriginPrice").html("")}$("#minicart-goods-list").html(ec.minicart.microCartTpl.parse("microCartList",b));h.show();g.show();d.hide();if((b.productList.length+b.bundlerList.length)>5){h.addClass("minicart-pro-list-scroll")}else{h.removeClass("minicart-pro-list-scroll")}}else{d.show();h.hide();g.hide()}}})};ec.minicart.click=function(i){if($("#icon-choose-"+i).hasClass("icon-choose")){$("#icon-choose-"+i).removeClass("icon-choose").addClass("icon-choose-normal");$("#checkbox-"+i).attr("checked",false)}else{$("#icon-choose-"+i).removeClass("icon-choose-normal").addClass("icon-choose");$("#checkbox-"+i).attr("checked",true)}var e=$("#minicart-goods-list input[name='skuIds']:checked").length+$("#minicart-goods-list input[name='bundleIds']:checked").length;if(e==0){$("#header-cart-total").html(0);$("#micro-cart-totalPrice").html("&yen;&nbsp;"+0);$("#micro-cart-totalOriginPrice").html("");$("#button-minicart-go2confirm").hide();$("#disbutton-minicart-go2confirm").show();return}$("#button-minicart-go2confirm").show();$("#disbutton-minicart-go2confirm").hide();var b=$("#minicart-goods-list input[name='skuIds']:checked");var h=$("#minicart-goods-list input[name='bundleIds']:checked");var c=[];b.each(function(){var l=$(this).closest("li");var j=this.value;var r=$("#quantity-"+j,l).val();var n=$("#quantity-"+j,l).attr("data-type");var o={};var q={};var p={};var k=$('input[name="extendIds"]',l).val();if(k){q.itemId=k;q.qty=r;q.itemType="S1";q.itemProp={main_skucode:j};c.push(q)}var m=$('input[name="accidentIds"]',l).val();if(m){p.itemId=m;p.qty=r;p.itemType="S6";p.itemProp={main_skucode:j};c.push(p)}if(r){o.itemId=j;o.qty=r;if(n=="1"){o.itemType="S0"}if(n=="8"){o.itemType="S0";o.itemProp={Internal_Purchase:"true"}}if(n=="2"){o.itemType="B"}if(n=="9"){o.itemType="B";o.itemProp={Internal_Purchase:"true"}}c.push(o)}});h.each(function(){var j=$(this).closest("li");var n=this.value;var m=$("#quantity-"+n,j).val();var k=$("#quantity-"+n,j).attr("data-type");var l={};if(m){l.itemId=n;l.qty=m;if(k=="2"){l.itemType="B"}if(k=="9"){l.itemType="B";l.itemProp={Internal_Purchase:"true"}}c.push(l)}});var g=ec.lang.json.stringify(c);var d=new Date();var f={};f.cartReqJson=g;f.t=d.getTime();$.ajax({url:"/page/baseInfo.json",type:"POST",dataType:"json",timeout:10000,traditional:true,data:f,success:function(j){if(!j.success||!j.cartInfo){return}else{var k=j.cartInfo;if(k.totalNumber>99){$("#header-cart-total").html("99+")}else{$("#header-cart-total").html(k.totalNumber||0)}if(k.totalNumber>0){$("#micro-cart-totalPrice").html("&yen;&nbsp;"+k.totalPrice.toFixed(2));if(k.totalOriginalPrice!=k.totalPrice){$("#micro-cart-totalOriginPrice").html("&yen;&nbsp;"+k.totalOriginalPrice.toFixed(2))}else{$("#micro-cart-totalOriginPrice").html("")}}}}})};ec.minicart.confirm=function(){var b=$("#minicart-goods-list input[name='skuIds']:checked");var i=$("#minicart-goods-list input[name='bundleIds']:checked");if(b.length==0&&i.length==0){alert("\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5546\u54c1\uff01");return}if(!ec.account.isLogin()){window.location.href=$("#top-index-loginUrl").attr("href")}var f=[];var d=[];var e=[];var g=[];var c=[];b.each(function(){var m=$(this).closest("li");var k=this.value;var p=$(this).attr("data-scode");var u=$("#quantity-"+k,m).val();var q=$("#quantity-"+k,m).attr("data-type");var r={};var t={};var s={};if(u){r.itemId=p;r.qty=u;if(q=="1"){r.itemType="S0"}if(q=="8"){r.itemType="S0";r.itemProp={Internal_Purchase:"true"}}var o=$('input[name="giftId"]',m);if(o.length>0){var j=[];o.each(function(){var v={sbomCode:this.value};j.push(v)});r.gifts=j}c.push(r)}var l=$('input[name="extendIds"]',m).attr("data-scode");if(l){t.itemId=l;t.qty=u;t.itemType="S1";t.itemProp={main_skucode:p};c.push(t)}var n=$('input[name="accidentIds"]',m).attr("data-scode");if(n){s.itemId=n;s.qty=u;s.itemType="S6";s.itemProp={main_skucode:p};c.push(s)}});i.each(function(){var j=$(this).closest("li");var n=this.value;var m=$("#quantity-"+n,j).val();var k=$("#quantity-"+n,j).attr("data-type");var l={};if(m){l.itemId=n;l.qty=m;if(k=="2"){l.itemType="B"}if(k=="9"){l.itemType="B";l.itemProp={Internal_Purchase:"true"}}c.push(l)}});var h=ec.lang.json.stringify(c);setTimeout(function(){ec.cart.confirm(1,h)},500)};ec.pkg("ec.product");ec.product.history={load:function(d,c,b){$.ajax({url:"/product/browsed/query.json",data:{size:c?c:undefined,pid:b?b:undefined},dataType:"json",success:function(e){if(!e.success){return}d(e.list||[])}})},add:function(c){var b=new Image();b.src="/product/browsed/add?id="+c+"&_t="+(new Date()).getTime();b=null},clear:function(c){var b=new Image();b.src="/product/browsed/clear?_t="+(new Date()).getTime();b=null;if(c){c()}}};ec.product.inventory={_data:{},set:function(c,b){this._data[c]=b},haveInventory:function(b){return this._data[b]}};ec.pkg("ec.cart");ec.cart.add=function(e,d,b,g){if(e.type==1){ec.code.addAnalytics({hicloud:false,operate:true,optype:1,skuIds:e.skuIds,bundleIds:[],custBundleIds:[],custSkuIds:[]})}else{if(e.type==2){ec.code.addAnalytics({hicloud:false,operate:true,optype:1,skuIds:[],bundleIds:e.skuIds,custBundleIds:[],custSkuIds:[]})}}var f={};f.sbs=e.skuIds.join(",");f.type=e.type.join(",");f.qty=e.quantity.join(",");if(e.extendSkuIds&&e.extendSkuIds.length>0){f.ess=e.extendSkuIds.join(",")}if(e.gifts){f.gfs=e.gifts}if(g){f.qty=e.quantity.join(",");var c=new Date();f.t=c.getTime();$.ajax({url:domainCart+"/cart/add.json",dataType:"jsonp",timeout:30000,traditional:true,data:f,success:function(h){if(!h.success){if(d.errorFunction){d.errorFunction(h)}return}if(d.successFunction){d.successFunction(h)}},error:function(k,j,i){if(d.errorFunction){var h={};h.msg=j;d.errorFunction(h)}}})}else{$.ajax({url:domainMain+"/order/shoppingCart/addcart.json",dataType:"jsonp",timeout:30000,traditional:true,data:{orderReqJson:b},success:function(i){if(!i.success){if(d.errorFunction){d.errorFunction(i)}return}if(d.successFunction){f.qty=e.quantity.join(",");var h=new Date();f.t=h.getTime();$.ajax({url:domainCart+"/cart/add.json",dataType:"jsonp",timeout:30000,traditional:true,data:f,success:function(j){if(!j.success){if(d.errorFunction){d.errorFunction(j)}return}if(d.successFunction){d.successFunction(j)}},error:function(m,l,k){if(d.errorFunction){var j={};j.msg=l;d.errorFunction(j)}}})}},error:function(k,j,i){if(d.errorFunction){var h={};h.msg=j;d.errorFunction(h)}}})}};ec.cart.getCartItemsInternal=function(c,b){$.ajax({url:domainCart+"/cart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(d){if(d.cart&&d.cart.length>0){c(d.cart,b)}else{c(null,b)}}})};ec.cart.getCartItems=function(e,b){var d=ec.util.cookie.get("cartId");if(d&&d.length>0){var c=ec.util.cookie.get("isValCas");if(c&&"false"==c){$.ajax({url:"/account/load",type:"POST"});c=ec.util.cookie.get("isValCas")}if(ec.account.isLogin()){$.ajax({url:domainCart+"/cart/cache2cart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,cache:false,success:function(f){ec.cart.getCartItemsInternal(e,b)}})}else{ec.cart.getCartItemsInternal(e,b)}}else{ec.cart.getCartItemsInternal(e,b)}};ec.cart.buildQueryData=function(f){var j=[];var h=[];var c=[];var d=[];for(var g=0;g<f.length;g++){var b=f[g];if(b.skuId){j.push(b.skuId)}else{if(b.bundleId){j.push(b.bundleId)}else{continue}}h.push(b.productType);c.push(b.quantity);if(b.mainSkuId){d.push(b.mainSkuId)}else{d.push("")}}var e=new Date();return{sbs:j.join(","),types:h.join(","),qtys:c.join(","),ess:d.join(","),t:e.getTime()}};ec.cart.getOnceCartInfo=function(b,e,c){var d=ec.cart.buildQueryData(b);$.ajax({url:domainMain+"/order/shoppingCart/newCart.json",dataType:"jsonp",timeout:10000,traditional:true,data:d,success:function(f){if(c!=null){e(f,c)}else{if(!f.success||!f.cartInfo){return}else{e(f)}}},error:function(){if(c!=null){var f={};f.success=false;e(f,c)}}})};ec.cart.batchCount=50;ec.cart.getCartInfo=function(f,p){if(!f||f.length==0){p({});return}if(f.length<=ec.cart.batchCount){ec.cart.getOnceCartInfo(f,p)}else{var o=[];var b=[];var e=[];outer:for(var l=0;l<f.length;l++){var c=f[l];if(c.productType==1){e.push(c);if(e.length==ec.cart.batchCount){o.push(e);e=[]}}else{if(c.productType==6){for(var g=0;g<o.length;g++){var h=o[g];if(h[0].productType==1){for(var d=0;d<h.length;d++){if(h[d].skuId==c.mainSkuId){h.push(c);continue outer}}}}for(var g=0;g<e.length;g++){if(e[g].skuId==c.mainSkuId){e.push(c)}}}else{b.push(c);if(b.length==ec.cart.batchCount){o.push(b);b=[]}}}}if(b.length>0){if(b.length+e.length<=ec.cart.batchCount){b.push(e);o.push(b)}else{o.push(b);o.push(e)}}else{if(e.length>0){o.push(e)}}var n={};n.cartInfo={};n.cartInfo.bundlerList=[];n.cartInfo.productList=[];n.cartInfo.couponList=[];n.cartInfo.premiumsList=[];n.cartInfo.totalOriginalPrice=0;n.cartInfo.totalPrice=0;n.limitstock=[];n.understock=[];var m=0;for(var l=0;l<o.length;l++){var h=o[l];ec.cart.getOnceCartInfo(h,function(j,k){m+=1;if(j.success&&j.cartInfo){if(j.cartInfo.bundlerList&&j.cartInfo.bundlerList.length>0){n.cartInfo.bundlerList=n.cartInfo.bundlerList.concat(j.cartInfo.bundlerList)}if(j.cartInfo.productList&&j.cartInfo.productList.length>0){n.cartInfo.productList=n.cartInfo.productList.concat(j.cartInfo.productList)}if(j.cartInfo.couponList&&j.cartInfo.couponList.length>0){n.cartInfo.couponList=n.cartInfo.couponList.concat(j.cartInfo.couponList)}if(j.cartInfo.premiumsList&&j.cartInfo.premiumsList.length>0){n.cartInfo.premiumsList=n.cartInfo.premiumsList.concat(j.cartInfo.premiumsList)}n.cartInfo.totalOriginalPrice+=j.cartInfo.totalOriginalPrice;n.cartInfo.totalPrice+=j.cartInfo.totalPrice;if(j.limitstock&&j.limitstock.length>0){n.limitstock=n.limitstock.concat(j.limitstock)}if(j.understock&&j.understock.length>0){n.understock=n.understock.concat(j.understock)}}if(m==o.length){p(n)}},l)}}};ec.cart.getCart=function(b){ec.cart.getCartItems(ec.cart.getCartInfo,b)};ec.cart.getCartBaseInfo=function(b,d){if(b&&b.length>0){var c=ec.cart.buildQueryData(b);$.ajax({url:"/page/baseInfo.json",type:"POST",dataType:"json",data:c,success:function(e){d(e)}})}else{d({cartInfo:{totalNumber:0,totalPrice:0}})}};ec.cart.getCartBase=function(b){ec.cart.getCartItems(ec.cart.getCartBaseInfo,b)};ec.cart.buildMicroCartReq=function(f){var l=[];if(f&&f.length>0){for(var k=0;k<f.length;k++){var c=f[k];var m={};m.itemId=c.skuId;m.qty=c.quantity;if(c.productType=="1"){m.itemType="S0";var b=[];if(c.giftCartList&&c.giftCartList.length>0){for(var g=0;g<c.giftCartList.length;g++){var e={sbomCode:c.giftCartList[g].skuId};b.push(e)}}m.gifts=b}if(c.productType=="8"){m.itemType="S0";m.itemProp={Internal_Purchase:"true"}}if(c.productType=="6"){m.itemType="S1";m.itemProp={main_skucode:c.mainSkuId}}if(c.productType=="7"){m.itemType="S6";m.itemProp={main_skucode:c.mainSkuId}}if(c.productType=="2"){m.itemId=c.bundleId;m.itemType="B"}if(c.productType=="9"){m.itemId=c.bundleId;m.itemType="B";m.itemProp={Internal_Purchase:"true"}}l.push(m)}}var n=ec.lang.json.stringify(l);var d=new Date();var h={};h.cartReqJson=n;h.t=d.getTime();return h};ec.cart.getMicroCartBaseInfo=function(b,d){if(b&&b.length>0){var c=ec.cart.buildMicroCartReq(b);$.ajax({url:"/page/baseInfo.json",type:"POST",dataType:"json",data:c,success:function(e){d(e)}})}else{d({cartInfo:{totalNumber:0,totalPrice:0}})}};ec.cart.getMicroCartFromOrder=function(b){ec.cart.getCartItems(ec.cart.getMicroCartBaseInfo,b)};ec.cart.getTotal=function(){ec.cart.getMicroCartFromOrder(function(e){var b=e.cartInfo,d=e.shopInfo,c=$("#minicart-pro-empty"),g=$("#minicart-pro-list-block"),f=$("#minicart-pro-settleup");if(ec.minicart.microCartTpl){$("#header-cart-total,#micro-cart-total").html(b.totalNumber||0);if(b.totalNumber>0){$("#micro-cart-totalPrice").html("&yen;&nbsp;"+b.totalPrice.toFixed(2));$("#minicart-pro-list").html(ec.minicart.microCartTpl.parse("microCartList",b));g.show();f.show();c.hide();if((b.productList.length+b.bundlerList.length)>5){g.addClass("minicart-pro-list-scroll")}else{g.removeClass("minicart-pro-list-scroll")}}else{c.show();g.hide();f.hide()}if(d){$("#toolbar-orderWaitingHandleCount").html(d.orderWaitingHandleCount).attr("class",(d.orderWaitingHandleCount<=0)?"hide":"");$("#toolbar-couponCount").html(d.couponCount).attr("class",(d.couponCount<=0)?"hide":"");$("#toolbar-newMsgCount").html(d.newMsgCount).attr("class",(d.newMsgCount<=0)?"hide":"");$("#top-couponCount").html(d.couponCount);$("#top-newMsgCount").html(d.newMsgCount).attr("class",(d.newMsgCount<=0)?"hide":"")}}if(e.enterpriseUser){$("#preferential").html('<a  href="'+domainMain+'/member/enterprise" title="\u4f18\u60e0\u5185\u8d2d" rel="nofollow">\u4f18\u60e0\u5185\u8d2d</a>').show();$("#li-enterprise").html('<a href="'+domainMain+'/member/enterprise" title="\u4f18\u60e0\u5185\u8d2d"><span>\u4f18\u60e0\u5185\u8d2d</span></a>').show()}})};ec.cart.del=function(g,l,e){var k=g.types.split(",");var m=[];var h=[];var b=g.sbs.split(",");var j=b.length;for(var f=0;f<j;f++){if(k[f]==1){m.push(b[f])}else{if(k[f]==2){h.push(b[f])}}}ec.code.addAnalytics({hicloud:false,operate:true,optype:0,skuIds:m,bundleIds:h,custBundleIds:[],custSkuIds:[]});if(!e){ec.ui.loading.show({modal:false})}var c=new Date();g.t=c.getTime();var d={data:g,dataType:"jsonp",timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(i){if(!i.success){ec.ui.loading.hide();ec.showError(i);return}if(l){l(i)}ec.ui.loading.hide();return}};d.url=domainCart+"/cart/del.json";new ec.ajax().get(d)};ec.cart.setRecover=function(b){ec.util.cookie.set("cart-recover",b,{domain:".vmall.com",path:"/"})};ec.cart.removeSkuFromRecover=function(c,e){var b=ec.util.cookie.get("cart-recover");if(b){var d=new RegExp(","+c+";\\d+,");b=b.replace(d,",");ec.cart.setRecover(b)}if(e){e(b)}};ec.cart.jumpToConfirm=function(b,i){var f=[];var d=[];var e=[];var g=[];var c=[];b.each(function(){var m=$(this).closest("tbody");var k=this.value;var p=$(this).attr("data-scode");var u=$("#quantity-"+k,m).val();var q=$("#quantity-"+k,m).attr("data-type");var r={};var t={};var s={};var l=$('input[name="extendIds"]',m).attr("data-scode");if(l){t.itemId=l;t.qty=u;t.itemType="S1";t.itemProp={main_skucode:p};c.push(t)}var o=$('input[name="accidentIds"]',m).attr("data-scode");if(o){s.itemId=o;s.qty=u;s.itemType="S6";s.itemProp={main_skucode:p};c.push(s)}if(u){r.itemId=p;r.qty=u;if(q=="1"){r.itemType="S0"}if(q=="8"){r.itemType="S0";r.itemProp={Internal_Purchase:"true"}}var n=$('input[name="giftId"]',m);if(n.length>0){var j=[];n.each(function(){var v={sbomCode:this.value};j.push(v)});r.gifts=j}c.push(r)}});i.each(function(){var j=$(this).closest("tbody");var n=this.value;var m=$("#quantity-bundle-"+n,j).val();var k=$("#quantity-bundle-"+n,j).attr("data-type");var l={};if(m){l.itemId=n;l.qty=m;if(k=="2"){l.itemType="B"}if(k=="9"){l.itemType="B";l.itemProp={Internal_Purchase:"true"}}c.push(l)}});var h=ec.lang.json.stringify(c);setTimeout(function(){ec.cart.confirm(1,h)},500)};ec.cart.confirm=function(d,e,c){var b=$('<form action="'+domainMain+'/order/confirmcart" method="post"></form>');b.append('<input name="orderReqJson" type="hidden" value=\''+e+"' />");if(d){b.append('<input name="state" type="hidden" value="'+d+'" />')}if(c){b.append('<input name="orderTag" type="hidden" value="'+c+'" />')}$("body").append(b);b.submit()};ec.pkg("ec.base");ec.base.getTotal=function(){$.ajax({url:domainMain+"/page/totalInfo.json",dataType:"jsonp",success:function(c){if(c.enterpriseUser){$("#preferential").html('<a href="'+domainMain+'/member/enterprise" title="\u4f18\u60e0\u5185\u8d2d" rel="nofollow">\u4f18\u60e0\u5185\u8d2d</a>').show();$("#li-enterprise").html('<a href="'+domainMain+'/member/enterprise" title="\u4f18\u60e0\u5185\u8d2d"><span>\u4f18\u60e0\u5185\u8d2d</span></a>').show()}if(ec.account.isLogin()){var b=ec.util.cookie.get("isAuthCust");if("true"==b){$("#authentication").html("");$("#authentication").html('<i class="icon-authentication icon-authentication-success"></i>&nbsp;');$("#authentication_yes").removeClass().addClass("");$("#authentication_no").removeClass().addClass("hide")}else{$("#authentication").html("");$("#authentication").html('<i class="icon-authentication icon-authentication-not"></i>&nbsp;');$("#authentication_yes").removeClass().addClass("hide");$("#authentication_no").removeClass().addClass("");$("#authentication_no").html("");$("#authentication_no").html('<i class="link-non-validated"></i>\u672a\u5b9e\u540d\u8ba4\u8bc1</a>')}}}})};var topSearchKeyword="";function search(c){var b=$("#search-kw").val();if(ec.util.isEmpty(b)){return false}b=$.trim(b);window.location.href="/search?keyword="+encodeURIComponent(b);return false}(function(){var b;ec.ready(function(){$("#ec_ui_confirm_no").unbind("click").click(function(){$("#ec_ui_confirm").hide()});$("#ec_ui_confirm_new_no").unbind("click").click(function(){$("#ec_ui_confirm_new").hide()});$("#ec_ui_tips_yes").unbind("click").click(function(){$("#ec_ui_tips").hide()})});ec.ui.confirm=function(j,e){var d=ec.ui.confirm.caller,c=d.arguments;if(b!=null&&c[c.length-1]==b){b=null;return true}$("#ec_ui_confirm_msg").html(e);var n=$(j),g=$("#ec_ui_confirm"),k=n.offset(),p=k.top-g.outerHeight(true)-5,f=k.left-g.outerWidth(true)/2,o=[],h=c.length,m=c.callee.length;for(var l=0;l<h;l++){o.push(c[l])}o[m]=(b=(new Date()).getTime());$("#ec_ui_confirm_yes").unbind("click").click(function(){$("#ec_ui_confirm").hide();d.apply(this,o);o=null});g.css({top:p,left:f,position:"absolute"}).show();g.css("z-index","999");return false};ec.ui.confirmNew=function(l,e,g,q){var d=ec.ui.confirmNew.caller,c=d.arguments;if(b!=null&&c[c.length-1]==b){b=null;return true}$("#ec_ui_confirm_new_msg").html(e);if(g){$("#ec_ui_confirm_new_yes").attr("title",g);$("#ec_ui_confirm_new_yes").html("<span>"+g+"</span>")}if(q){$("#ec_ui_confirm_new_no").attr("title",q);$("#ec_ui_confirm_new_no").html("<span>"+q+"</span>")}var o=$(l),h=$("#ec_ui_confirm_new"),k=o.offset(),r=k.top-h.outerHeight(true)-5,f=k.left-h.outerWidth(true)/9,p=[],j=c.length,n=c.callee.length;for(var m=0;m<j;m++){p.push(c[m])}p[n]=(b=(new Date()).getTime());$("#ec_ui_confirm_new_yes").unbind("click").click(function(){$("#ec_ui_confirm_new").hide();d.apply(this,p);p=null});h.css({top:r,left:f,position:"absolute"}).show();return false};ec.ui.tips=function(i,h){$("#ec_ui_tips_msg").html(h);var d=$(i),c=$("#ec_ui_tips"),g=d.offset(),f=g.top-c.outerHeight(true)-5,e=g.left-c.outerWidth(true)/2;c.css({top:f,left:e,position:"absolute"}).show()}})();$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(d,b){var c="icon-error",e=b.msg[b.type]||b.msg["default"];e=(e.length<=0)?"&nbsp;":e;switch(b.type){case"require":c="icon-warn";break}if(b.msg_ct){$(b.msg_ct).html("<span class='vam "+c+"'>"+e+"</span>")}else{var f=(d.attr("id")||d.attr("name"))+"-msg";$("#"+f).remove();d.after("<span id='"+f+"' class='vam "+c+"'>"+e+"</span>")}if(b.autoFocus){d.focus()}},successFunction:function(c,b){if(b.msg_ct){$(b.msg_ct).html("")}else{$("#"+(c.attr("id")||c.attr("name"))+"-msg").remove()}}});ec.form.validator.register("mobile",function(c,b){if(b.allowEmpty&&ec.util.isEmpty(c)){return true}if(c.length<11){return false}return/^(\+|00)?((86)?(1[34578])[0-9]{9}|852[965][0-9]{7})$/.test(c)});ec.form.validator.register("phone",function(c,b){if(b.allowEmpty&&ec.util.isEmpty(c)){return true}if(c.length<7){return false}return/^((0[0-9]{2,3}\-)?[2-9][0-9]{6,7}|((00852|\+852)\-)?([2-3][0-9]{7}))+(\-[0-9]{1,4})?$/.test(c)});ec.form.validator.register("mobleOrPhone",function(c,b){if(b.allowEmpty&&ec.util.isEmpty(c)){return true}if(c.length<11){return false}return/(^((0[0-9]{2,3}\-)?[2-9][0-9]{6,7}|((00852|\+852)\-)?([2-3][0-9]{7}))+(\-[0-9]{1,4})?$)|(^(\+|00)?((86)?(1[34578])[0-9]{9}|852[965][0-9]{7})$)/.test(c)});ec.form.validator.register("forbidChar",function(c,b){if(b.allowEmpty&&ec.util.isEmpty(c)){return true}c=c.replace("*","@"),c=c.replace("--","@"),c=c.replace("/","@"),c=c.replace("+","@"),c=c.replace("'","@"),c=c.replace("\\","@"),c=c.replace("$","@"),c=c.replace("^","@"),c=c.replace(".","@"),c=c.replace(";","@"),c=c.replace("<","@"),c=c.replace(">","@"),c=c.replace('"',"@"),c=c.replace("=","@"),c=c.replace("{","@"),c=c.replace("}","@");c=c.replace("%","@");c=c.replace("~","@");c=c.replace("&","@");if(c.search(new RegExp("@"))!=-1){return false}return true});ec.form.validator.register("invoiceForbidChar",function(e,c){if(c.allowEmpty&&ec.util.isEmpty(e)){return true}e=e.replace("--","&");var d=/^[^\\*\\+\\\\/\\$\\^\\;<>\"=\\{\\}%~&]+$/g;var b=d.test(e);if(!b){return false}return b});ec.form.validator.register("forbidChar2",function(d,c){if(c.allowEmpty&&ec.util.isEmpty(d)){return true}var b=/^[^<>\\(\\)\'\"]+$/g;return b.test(d)});ec.ui.number=function(b,c){var d={max:null,min:null,showButton:true,minusBtn:'<a title="\u51cf" class="icon-minus vam" href="javascript:;"><span>-</span></a>',plusBtn:'<a title="\u52a0" class="icon-plus vam" href="javascript:;"><span>+</span></a>'},e=$(b),c=$.extend(d,c),f=function(g){var i=g.which,h=parseInt(this.value,10),j=(h<1)?1:h;if((i<37||i>40)&&i!=8&&i!=46){if(j>c.max||j<c.min){g.preventDefault();return false}else{if((i<48||i>57)&&(i<96||i>105)&&i!=9){g.preventDefault();return false}}}};e.each(function(){var i=$.extend({},c),g=$(this).css("ime-mode","disabled");var h=g.attr("max");if(h){c.max=i.max=parseInt(h,10)||i.max}h=g.attr("min");if(h){c.min=i.min=parseInt(h,10)||i.min}if(i.showButton){var k=$(i.minusBtn).click(function(){var l=g.val()||0,m=parseInt(l,10)-1;if(typeof(i.min)=="number"&&m<i.min){return}g.val(m).trigger("blur")}),j=$(i.plusBtn).click(function(){var l=g.val()||0,m=parseInt(l,10)+1;if(typeof(i.max)=="number"&&m>i.max){return}g.val(m).trigger("blur")});g.after(j).before(k)}g.data("ovalue",g.val()||0).keydown(f).keyup(function(){var l=parseInt(this.value||0);if(typeof(i.min)=="number"&&l<i.min){this.value=i.min;return}else{if(typeof(i.max)=="number"&&l>i.max){this.value=i.max;return}}}).blur(function(){if(typeof i.onchange==="function"){var l=g.data("ovalue"),m=this.value||0,n=parseInt(m,10)-parseInt(l,10);if(n==0){return}g.data("ovalue",m);i.onchange.call(this,m,n)}})})};ec.ui.countdown=function(e,m){var g=$(e),c=g.data("countdown"),l=0,j,k,f=m.now.getTime()-new Date().getTime(),d=0,i=function(){if(l>=m.times.length){return false}j=m.times[l];l++;return true},h=function(){d=Math.round((j.parseDate("yyyy-MM-dd HH:mm:ss").getTime()-new Date().getTime()-f)/1000);d=d<=0?0:d;return d},b=function(){d--;if(d<=0){d=0}k={day:Math.floor(d/(24*60*60)),hour:(m.html.indexOf("{#day}")>=0)?Math.floor(d/60/60)%24:Math.floor(d/60/60),minute:Math.floor(d/60)%60,second:d%60};var n=m.html.replace(/{#day}/g,k.day).replace(/{#hours}/g,k.hour>9?k.hour:"0"+k.hour).replace(/{#minutes}/g,k.minute>9?k.minute:"0"+k.minute).replace(/{#seconds}/g,k.second>9?k.second:"0"+k.second);g.html(n);return(d<=0)?false:true};if(!m.times){m.times=[m.endTime]}clearInterval(c);while(i()){if(h()<=0){continue}break}if(!b()){return}c=setInterval(function(){if(!b()){if(m.callback){m.callback(m)}if(!i()){clearInterval(c)}else{h()}}},1000);g.data("countdown",c)};(function(){var c=$(window),j=false,b=document.compatMode=="CSS1Compat"?document.documentElement:document.body,g=0,d=0,h,e=[],f,i=function(k){var l=k.offset().top-300,m=l+k.height()+600;if((l>=g&&l<=d)||(m>=g&&m<=d)){k.attr("src",k.attr("data-lazy-src"));k.removeAttr("data-lazy-src");return true}return false};_bindEvent=function(){var k=function(){clearTimeout(f);f=setTimeout(function(){g=c.scrollTop();d=g+h;var m;for(var n=0;n<e.length;n++){m=e[n];if(i(m)){e.splice(n,1);n--}}if(!e||e.length==0){c.unbind("scroll",k);c.unbind("resize",l)}},100)},l=function(m){h=b.clientHeight};c.bind("scroll",k);c.bind("resize",l);h=b.clientHeight;g=c.scrollTop();d=g+h};ec.ui.lazyLoad=function(k){if(!j){_bindEvent();j=true}$(k).each(function(){if(this.tagName!="IMG"){return}var l=$(this);if(l.attr("data-lazy-src")){if(!i(l)){l.attr("src",ol.libPath+"../../images/echannel/loading/mask.png");e.push(l)}}})}})();ec.ready(function(){ec.ui.lazyLoad($("body").children(".home-channel-menu,.layout,.g,.home-channel-container,.channel-floor,.home-channel-floor").find("img"));ec.ui.hrefSetTime()});ec.showError=function(b){if(b.code=="login"){alert("\u767b\u5f55\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55");location.reload();return false}alert(b.msg)};ec.load("ajax",{loadType:"lazy"});(function(){var b=function(){var f=ec.form.validator.bind,e=$("#surveryContent"),c=$("#surveryContact"),d=$("#surveryVerify");f(e,{type:["require","length","forbidChar"],validOnChange:true,msg_ct:"#errMsg",max:200,min:5,msg:{require:"\u60a8\u8fd8\u6ca1\u6709\u8f93\u5165\u53cd\u9988\u4fe1\u606f\u54e6",length:"\u53cd\u9988\u4fe1\u606f\u5185\u5bb9\u8bf7\u63a7\u5236\u57285~200\u4e2a\u5b57\u7b26\u4e4b\u95f4",forbidChar:"\u53cd\u9988\u4fe1\u606f\u91cc\u5305\u542b\u975e\u6cd5\u5b57\u7b26"}});f(c,{type:["length"],validOnChange:true,msg_ct:"#errMsg",min:2,max:100,msg:{length:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8054\u7cfb\u65b9\u5f0f"}});f(d,{type:["require"],validOnChange:true,msg_ct:"#errMsg",msg:{require:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"}});if(ec.account.isLogin()){c.val(ec.util.escapeHtml(ec.account.email)||ec.util.escapeHtml(ec.account.mobile)||ec.account.loginName)}ec.form.input.label(c,"\u9009\u586b\uff0c\u90ae\u7bb1\u6216\u8005\u5546\u57ce\u8d26\u6237");ec.form.input.label(e,"\u8c22\u8c22\u60a8\u7684\u5b9d\u8d35\u5efa\u8bae\uff0c\u6211\u4eec\u5c06\u4e0d\u65ad\u6539\u8fdb")};ec.survery={open:function(){if(b){b();b=null}var h=$("#survery-box");var d=$(window).width();var g=$(window).height();var f=h.width();var c=h.height();var e=document.createElement("div");e.className="mask-new";e.style.width=d+"px";e.style.height=g+"px";e.style.background="#000";e.style.position="fixed";e.style.top=0;e.style.left=0;e.style.zIndex=499;e.style.opacity=0.4;e.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";document.body.appendChild(e);ec.survery.reloadCode();$("#survery-box").css({position:"fixed",left:(d/2-f/2)+"px",top:(g/2-c/2)+"px","z-index":999}).show();$(window).resize(function(){d=$(window).width();g=$(window).height();$("#survery-box").css({left:(d/2-f/2)+"px",top:(g/2-c/2)+"px"})})},close:function(){ol.ui.masker.unmask();$(".mask-new").remove();$("#survery-box").hide()},submit:function(){var c=$("#form-feedback");if(!ec.form.validator(c,true)){return false}$.ajax({type:"get",url:domainMain+"/feedback.json",dataType:"jsonp",timeout:10000,async:true,data:{type:$("#surverytype").val(),content:$("#surveryContent").val(),contact:$("#surveryContact").val(),code:$("#surveryVerify").val()},success:function(d){if(!d.success){$("#errMsg").html('<span class="vam icon-warn">\u63d0\u4ea4\u5931\u8d25\uff0c'+d.msg+"</span>");return}alert("\u63d0\u4ea4\u6210\u529f\uff0c\u534e\u4e3a\u5546\u57ce\u611f\u8c22\u60a8\u7684\u5b9d\u8d35\u5efa\u8bae\uff01");ec.survery.close();$("#surveryContent,#surveryVerify").val("");return}});return false},reloadCode:function(){gid("surveryVerifyImg").src=domainMain+"/feedback/randomCode?_t="+(new Date()).getTime()}}})();$(function(){var d=$(window),e,c=$("#hungBar-top"),b=function(){c.stop();if(d.scrollTop()>1200){c.fadeTo(20,1)}else{c.fadeOut(20)}e=null};d.scroll(function(){e=setTimeout(b,50)});b()});(function(){ec.ui.hrefSetTime=function(){var c=(new Date()).getTime();try{$("a[timeType=timestamp]").each(function(){var d=$(this);d.attr("href",d.attr("href").replace(/timestamp/g,c))})}catch(b){console.log(b)}}})();ec.pkg("ec.encipher");ec.encipher.base=10;ec.encipher.bigPowMod=function(f,e,g){f=str2bigInt(f,ec.encipher.base);e=str2bigInt(e,ec.encipher.base);g=str2bigInt(g,ec.encipher.base);var d=powMod(f,e,g);d=bigInt2str(d,ec.encipher.base);return d};ec.encipher.randomInt=function(c){var b=randBigInt(c,0);return bigInt2str(b,ec.encipher.base)};ec.encipher.getServerKey=function(){$.ajax({type:"get",url:"/system/getKey.json?t="+new Date().getTime(),async:false,dataType:"json",timeout:10000,success:function(b){if(!(b.success)){return}ec.util.cookie.set("sc_p",b.pubkey)}})};ec.encipher.getEncryptData=function(c,e,k){var m="";var h="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",l="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",j=ec.encipher.randomInt(128),d=ec.encipher.bigPowMod(l,j,h),f=ec.util.cookie.get("sc_p"),i,g;if(e==""||e==null){g=c+"?pubkey="+d+"&seType=r&t="+new Date().getTime()}else{g=c+"?argument="+e+"&pubkey="+d+"&seType=r&t="+new Date().getTime()}$.ajax({type:"get",url:g,dataType:"json",async:false,timeout:10000,success:function(b){if(!b.success){return}i=ec.encipher.bigPowMod(f,j,h);m=k(b.data,i)}});return m};ec.encipher.getKey=function(h){var e="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",f="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",c=ec.encipher.randomInt(128),g=ec.encipher.bigPowMod(f,c,e),d;$.ajax({type:"get",url:domainShoppingConfig+"/member/smyAddresses.json?pubkey="+g+"&seType=r&t="+new Date().getTime(),dataType:"jsonp",async:true,timeout:10000,success:function(b){if(!b.success){return}ec.util.cookie.set("sc_p",b.pubkey);d=ec.encipher.bigPowMod(b.pubkey,c,e);h(b.shoppingConfigList,b.randomFlag,d)}})};ec.encipher.encrypt=function(i){var e="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",h="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",c=ec.encipher.randomInt(128),j=ec.encipher.bigPowMod(h,c,e),f=ec.util.cookie.get("sc_p"),d=ec.encipher.bigPowMod(f,c,e);if(d.length>16){d=d.substring(0,16)}var g=rc4_str_base64(d,i);return{val:g,pubkey:j}};ec.encipher.decrypt=function(c,b){if(b.length>16){b=b.substring(0,16)}return rc4_base64_str(b,c)};ec.pkg("ec.addr");ec.addr.list=function(b){$.ajax({type:"get",url:domainShoppingConfig+"/member/myAddresses/list.json",dataType:"jsonp",async:true,timeout:10000,success:function(c){if(!c.success){return}b(c.shoppingConfigList,c.randomFlag)}})};ec.addr.save=function(c,e){var l=$(c);var q=l.find("input[name=id]").val();var g="/member/myAddresses/add.json";var n="post";var b=l.find("select[name=province]").val();var s=l.find("select[name=city]").val();var r=l.find("select[name=district]").val();var m=l.find("select[name=street]").val();if(!b||!s||!r){l.find("#myAddress-msg").addClass("icon-error label-error");return}else{if(m==""){l.find("#myAddress-msg").addClass("icon-error label-error");return}else{l.find("#myAddress-msg").removeClass("icon-error label-error")}}var j=l.find("input[name=mobile]");var o=l.find("input[name=phone]");if(j.hasClass("error")||o.hasClass("error")){return false}if(!ec.form.validator(l,false)){return false}var d=$.trim(l.find("input[name=mobile]").val());var h=$.trim(l.find("input[name=phone]").val());if(ec.util.isEmpty(d)){return false}if(e.afterCheck){e.afterCheck(q)}if(e.type!="add"){g="/member/myAddresses/modify/"+q+".json"}var i=l.find("input[name=consignee]").val();var f=l.find("input[name=address],textarea[name=address]").val();var k=l.find("input[name=zipCode]").val();var p=l.find("input[name=randomFlag]").val();var u={};u.consignee=i;u.province=b;u.city=s;u.district=r;u.street=m;u.address=f;u.zipCode=k;u.mobile=d;u.phone=h;u.randomFlag=p;var t=l.find("input[name=defaultFlag]");if(t.length==1&&t[0].checked&&!t[0].disabled){u.defaultFlag=t.val()}u.t=new Date().getTime();new ec.ajax().get({url:domainShoppingConfig+g+"?_method="+n,data:u,dataType:"jsonp",timeout:20000,timeoutFunction:function(){alert("\u4fdd\u5b58\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(v){if(!v.success){ec.showError(v);return}if(e.successFunction){e.successFunction(v.shoppingConfigList,c)}}});return false};ec.addr.setDefault=function(d,b){var c=ec.util.cookie.get("sc_b");new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses/default.json?id="+d+"&_method=PUT&t="+new Date().getTime(),dataType:"jsonp",timeout:20000,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(e){if(!e.success){ec.showError(e);return}if(b.successFunction){b.successFunction(d)}}})};ec.addr.getAll=function(b){new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses.json",dataType:"jsonp",timeout:20000,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(c){if(!c.success){ec.showError(c);return}if(b.successFunction){b.successFunction(c)}}})};ec.addr.del=function(c,b){new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses/"+c+".json?_method=delete",dataType:"jsonp",timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(d){if(!d.success){ec.showError(d);if(d.code=="default"){if(b.deleteDefault){b.deleteDefault(c)}}return}if(b.successFunction){b.successFunction(c)}}})};function base64_encode(f){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var d,c="",e=f.length;for(d=0;d<e-2;d+=3){c+=b.charAt(f.charCodeAt(d)>>>2);c+=b.charAt(((f.charCodeAt(d)&3)<<4)|(f.charCodeAt(d+1)>>>4));c+=b.charAt(((f.charCodeAt(d+1)&15)<<2)|(f.charCodeAt(d+2)>>>6));c+=b.charAt(f.charCodeAt(d+2)&63)}if(e%3===2){c+=b.charAt(f.charCodeAt(d)>>>2);c+=b.charAt(((f.charCodeAt(d)&3)<<4)|(f.charCodeAt(d+1)>>>4));c+=b.charAt(((f.charCodeAt(d+1)&15)<<2));c+="="}else{if(e%3===1){c+=b.charAt(f.charCodeAt(d)>>>2);c+=b.charAt(((f.charCodeAt(d)&3)<<4));c+="=="}}return c}function rc4_key(g){var e=Array(256);var f=Array(256);var d,b,c;for(d=0;d<256;d++){e[d]=g.charCodeAt(d%g.length);f[d]=d}for(d=0,b=0;d<256;d++){b=(b+f[d]+e[d])%256;c=f[d];f[d]=f[b];f[b]=c}return f}function rc4_do(h,g){var f=0,d=0,e;for(var b=0;b<h.length;b++){var f=(f+1)%256;var d=(d+g[f])%256;e=g[f];g[f]=g[d];g[d]=e;var c=(g[f]+(g[d]%256))%256;h[b]=h[b]^g[c]}return h}function rc4_str(f,e){e=decodeURIComponent(e);var c=rc4_key(f);var d=Array(e.length);for(var b=0;b<e.length;b++){d[b]=e.charCodeAt(b)}rc4_do(d,c);for(var b=0;b<d.length;b++){d[b]=String.fromCharCode(d[b])}return encodeURIComponent(d.join(""))}function rc4_str_base64(f,e){e=encodeURIComponent(e);var c=rc4_key(f);var d=Array(e.length);for(var b=0;b<e.length;b++){d[b]=e.charCodeAt(b)}rc4_do(d,c);for(var b=0;b<d.length;b++){d[b]=String.fromCharCode(d[b])}return base64_encode(d.join(""))}function base64_decode(j){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var d,c,b,n,m,l,k,o,h=0,p=0,f="",g=[];if(!j){return j}j+="";do{n=e.indexOf(j.charAt(h++));m=e.indexOf(j.charAt(h++));l=e.indexOf(j.charAt(h++));k=e.indexOf(j.charAt(h++));o=n<<18|m<<12|l<<6|k;d=o>>16&255;c=o>>8&255;b=o&255;if(l==64){g[p++]=String.fromCharCode(d)}else{if(k==64){g[p++]=String.fromCharCode(d,c)}else{g[p++]=String.fromCharCode(d,c,b)}}}while(h<j.length);f=g.join("");return f.replace(/\0+$/,"")}function rc4_base64_str(f,e){e=base64_decode(e);var c=rc4_key(f);var d=Array(e.length);for(var b=0;b<e.length;b++){d[b]=e.charCodeAt(b)}rc4_do(d,c);for(var b=0;b<d.length;b++){d[b]=String.fromCharCode(d[b])}return decodeURIComponent(d.join("").replace(/\+/g,"%20"))}ec.pkg("ec.prescription");ec.prescription.getEstimateGetOrderTime=function(e,c,d,b){$.ajax({url:"/order/estimateTime.json?d="+c+"&p="+d+"&i="+b,dataType:"jsonp",timeout:20000,jsonpCallback:"jsonpEstimate",timeout:function(){e(null,true)},beforeSend:function(){ec.ui.loading.show({modal:false})},complete:ec.ui.loading.hide,success:function(f){e(f.info,false)},error:function(){e(null,true)}})};getPointBalance=function(){$.ajax({url:$("#domainUc").val()+"/point/queryUserPointBalanceDetail.json",data:{},timeout:10000,dataType:"jsonp",success:function(b){if(b.resultCode!="200"){$("#newPointlogin_status").hide();return}var c=b.pointBlance;$("#userPointBalance").text(c)}})};ec.getLength=function(b){if(b==null){return 0}if(typeof b!="string"){b+=""}return b.replace(/[^\x00-\xff]/g,"01").length};ec.isChina=function(c){var b=/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi;if(!b.exec(c)){return false}else{return true}};ec.cutstr=function(f,b){var d=0;var e=0;str_cut=new String();e=f.length;if(!ec.isChina(f)){b=b+6}for(var c=0;c<e;c++){a=f.charAt(c);d++;if(escape(a).length>4){d++}str_cut=str_cut.concat(a);if(d>=b){str_cut=str_cut.concat("...");return str_cut}}if(d<b){return f}};ec.checkBrowerIE=function(){var b=window.navigator.userAgent;if(!!window.ActiveXObject||"ActiveXObject" in window||b.indexOf("MSIE")!=-1||b.indexOf("rv:")!=-1){return true}else{return false}};ec.freemarkerDecode=function(b){b=b.replaceAll("&apos;","'");b=b.replaceAll("&amp;","&");b=b.replaceAll("&quot;",'"');b=b.replaceAll("&nbsp;"," ");b=b.replaceAll("&lt;","<");b=b.replaceAll("&gt;",">");b=b.replaceAll("\t","&nbsp;&nbsp;");return b};ec.searchHistoryUnique=function(e){var c=[];console.log(e);for(var d=0;d<e.length;d++){var b=e[d];if($.inArray(b,c)==-1){c.push(b)}}console.log(c);return c};ec.pkg("ec.search");var searchHistoryMaxLength=48;ec.search.querySearchHistory=function(){if(ec.account.isLogin()){new ec.ajax().get({url:"/searchHistory.json?t="+new Date().getTime(),type:"get",dateType:"json",timeout:10000,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(f){if(f.success!=undefined&&!f.success){console.log("\u8fd4\u56de\u5f02\u5e38");return}var g=f.searchHistoryList;console.log(g);var e=[];var i;for(var d=0;d<g.length;d++){var c=g[d];var b=ec.getLength(c);var h=encodeURIComponent(c);e.push('<li><a href="/search?keyword='+h+'" data-value="'+h+'">');if(b>searchHistoryMaxLength){e.push($("<div/>").text(ec.cutstr(c,searchHistoryMaxLength)).html())}else{e.push($("<div/>").text(c).html())}e.push("</a></i>")}$("#search-history-list").html(e.join(""));$("#search-history").show()},errorFunction:function(b){console.log("\u8fd4\u56de\u5f02\u5e38")}})}};ec.search.deleteSearchHistory=function(){if(ec.account.isLogin()){new ec.ajax().get({url:"/search/clearUp.json?t="+new Date().getTime(),type:"get",dateType:"json",timeout:10000,timeoutFunction:function(){console.log("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(b){if(b.success!=undefined&&!b.success){console.log("\u8fd4\u56de\u5f02\u5e38");return}},errorFunction:function(b){console.log("\u8fd4\u56de\u5f02\u5e38")}})}};
